import{_ as ue,o as de,a as l,c as o,b as e,u as E,h as c,C as f,M as S,N as ce,F as V,g as M,t as n,i as C,G as ve,n as A,x as y,E as u,r as i,B as me,I as pe}from"./main-BuGC26DR.js";import{u as _e}from"./user-Cw0ViDKc.js";const ge={class:"community"},fe={class:"header"},ye={class:"posts-container"},ke={class:"search-section"},he={class:"posts-list"},be=["onClick"],Ce={class:"post-header"},we={class:"user-info"},$e={class:"username"},Ie={class:"time"},Ue={class:"post-stats"},Pe={class:"stat"},Te={class:"stat"},De={class:"stat"},Le={class:"post-content"},Ne={key:0,class:"post-images"},Se=["src","alt","onClick"],Ve={key:0,class:"pagination"},Me=["disabled"],xe=["disabled"],ze={key:1,class:"empty-state"},Xe={class:"modal-header"},Be={class:"modal-body"},Ee={class:"form-group"},Re={class:"form-group"},qe={class:"form-group"},Fe={class:"image-upload"},Je={key:0,class:"image-preview"},Ke=["src","alt"],Oe=["onClick"],Ae={class:"modal-actions"},Ge=["disabled"],je={class:"modal-header"},He={class:"modal-body"},Qe={class:"post-detail-content"},We={class:"post-meta"},Ye={class:"username"},Ze={class:"time"},es={class:"stats"},ss={class:"post-text"},ts={key:0,class:"post-images"},as=["src","alt","onClick"],ls={class:"comments-section"},os={key:0,class:"comment-input"},ns={class:"comment-actions"},is=["disabled"],rs={key:1,class:"login-prompt"},us={class:"comments-list"},ds={class:"comment-header"},cs={class:"comment-username"},vs={class:"comment-time"},ms={class:"comment-content"},ps={key:0,class:"reply-to"},_s={class:"comment-actions"},gs=["onClick"],fs=["onClick"],ys={key:0,class:"empty-comments"},ks={key:2,class:"comment-pagination"},hs=["disabled"],bs=["disabled"],Cs={class:"modal-header"},ws={class:"modal-body"},$s={class:"form-group"},Is={class:"modal-actions"},Us=["disabled"],Ps=["src"],Ts={__name:"Community",setup(Ds){const m=_e(),R=i([]),x=i(!1),_=i(1),w=i(1),q=i(""),k=i(!1),d=i({title:"",content:"",images:[]}),$=i(!1),F=i(!1),r=i(null),z=i(!1),X=i([]),J=i(!1),p=i(1),I=i(1),G=i(0),g=i({content:""}),U=i(!1),h=i(!1),P=i(null),b=i(""),T=i(!1),K=i(!1),j=i(""),H=pe(()=>d.value.title.trim()&&d.value.content.trim()),D=async()=>{try{x.value=!0;const a={page:_.value,size:10,keyword:q.value},s=await y.get("/api/post/list",{params:a});s.data.code===200&&(R.value=s.data.data.list,w.value=s.data.data.pages)}catch{u.error("åŠ è½½å¸–å­å¤±è´¥")}finally{x.value=!1}},ee=a=>{const s=a.target.files;if(s.length+d.value.images.length>3){u.warning("æœ€å¤šåªèƒ½ä¸Šä¼ 3å¼ å›¾ç‰‡");return}Array.from(s).forEach(N=>{if(N.size>5*1024*1024){u.warning("å•å¼ å›¾ç‰‡ä¸èƒ½è¶…è¿‡5MB");return}const t=new FileReader;t.onload=v=>{d.value.images.push(v.target.result)},t.readAsDataURL(N)})},se=a=>{d.value.images.splice(a,1)},te=async()=>{if(!(!H.value||$.value))try{$.value=!0;const a=await y.post("/api/post/create",{title:d.value.title,content:d.value.content,images:d.value.images.length>0?JSON.stringify(d.value.images):null},{headers:{"X-User-Id":m.user.id,"X-Username":m.user.username}});a.data.code===200?(u.success("å¸–å­å‘å¸ƒæˆåŠŸï¼"),k.value=!1,d.value={title:"",content:"",images:[]},D()):u.error(a.data.message||"å‘å¸ƒå¤±è´¥")}catch{u.error("å‘å¸ƒå¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{$.value=!1}},ae=async a=>{r.value=a,z.value=!1,F.value=!0,p.value=1,await L()},Q=()=>{F.value=!1,r.value=null,X.value=[],g.value={content:""}},le=async()=>{if(!(!r.value||z.value))try{(await y.post(`/api/post/like/${r.value.id}`)).data.code===200&&(z.value=!0,r.value.likes+=1,u.success("ç‚¹èµžæˆåŠŸ"))}catch{u.error("ç‚¹èµžå¤±è´¥")}},L=async()=>{if(r.value)try{J.value=!0;const a={postId:r.value.id,page:p.value,size:10},s=await y.get("/api/comment/list",{params:a});s.data.code===200&&(X.value=s.data.data.list,I.value=s.data.data.pages,G.value=s.data.data.total)}catch{u.error("åŠ è½½è¯„è®ºå¤±è´¥")}finally{J.value=!1}},oe=async()=>{if(!(!g.value.content.trim()||U.value))try{U.value=!0;const a=await y.post("/api/comment/create",{postId:r.value.id,content:g.value.content},{headers:{"X-User-Id":m.user.id,"X-Username":m.user.username}});a.data.code===200?(u.success("è¯„è®ºæˆåŠŸ"),g.value.content="",await L(),r.value.comments+=1):u.error(a.data.message||"è¯„è®ºå¤±è´¥")}catch{u.error("è¯„è®ºå¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{U.value=!1}},ne=a=>{P.value=a,b.value="",h.value=!0},ie=async()=>{if(!(!b.value.trim()||T.value))try{T.value=!0;const a=await y.post("/api/comment/reply",{postId:r.value.id,content:b.value,parentId:P.value.id,replyToUserId:P.value.userId,replyToUsername:P.value.username},{headers:{"X-User-Id":m.user.id,"X-Username":m.user.username}});a.data.code===200?(u.success("å›žå¤æˆåŠŸ"),h.value=!1,await L(),r.value.comments+=1):u.error(a.data.message||"å›žå¤å¤±è´¥")}catch{u.error("å›žå¤å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{T.value=!1}},re=async a=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿ"))try{const s=await y.post(`/api/comment/delete/${a}`);s.data.code===200?(u.success("åˆ é™¤æˆåŠŸ"),await L(),r.value.comments-=1):u.error(s.data.message||"åˆ é™¤å¤±è´¥")}catch{u.error("åˆ é™¤å¤±è´¥")}},W=a=>{a>=1&&a<=w.value&&(_.value=a,D())},Y=a=>{a>=1&&a<=I.value&&(p.value=a,L())},Z=a=>{j.value=a,K.value=!0},O=a=>{if(!a)return"";const s=new Date(a);return s.toLocaleDateString("zh-CN")+" "+s.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})};return de(()=>{D()}),(a,s)=>{const N=me("loading");return l(),o("div",ge,[e("header",fe,[s[22]||(s[22]=e("h1",null,"æ‘„å½±ç¤¾åŒº",-1)),E(m).isLoggedIn?(l(),o("button",{key:0,class:"create-btn",onClick:s[0]||(s[0]=t=>k.value=!0)}," å‘å¸ƒå¸–å­ ")):c("",!0)]),e("div",ye,[e("div",ke,[f(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>q.value=t),placeholder:"æœç´¢å¸–å­...",onKeyup:ce(D,["enter"])},null,544),[[S,q.value]]),e("button",{onClick:D},"æœç´¢")]),f((l(),o("div",he,[(l(!0),o(V,null,M(R.value,t=>(l(),o("div",{key:t.id,class:"post-card",onClick:v=>ae(t)},[e("div",Ce,[e("div",we,[e("span",$e,n(t.username),1),e("span",Ie,n(O(t.createTime)),1)]),e("div",Ue,[e("span",Pe,"ðŸ‘ï¸ "+n(t.views),1),e("span",Te,"ðŸ‘ "+n(t.likes),1),e("span",De,"ðŸ’¬ "+n(t.comments),1)])]),e("div",Le,[e("h3",null,n(t.title),1),e("p",null,n(t.content),1),t.images?(l(),o("div",Ne,[(l(!0),o(V,null,M(JSON.parse(t.images),(v,B)=>(l(),o("img",{key:B,src:v,alt:"å›¾ç‰‡"+(B+1),onClick:C(Ls=>Z(v),["stop"])},null,8,Se))),128))])):c("",!0)])],8,be))),128))])),[[N,x.value]]),w.value>1?(l(),o("div",Ve,[e("button",{disabled:_.value===1,onClick:s[2]||(s[2]=t=>W(_.value-1))}," ä¸Šä¸€é¡µ ",8,Me),e("span",null,n(_.value)+" / "+n(w.value),1),e("button",{disabled:_.value===w.value,onClick:s[3]||(s[3]=t=>W(_.value+1))}," ä¸‹ä¸€é¡µ ",8,xe)])):c("",!0),R.value.length===0&&!x.value?(l(),o("div",ze,[...s[23]||(s[23]=[e("p",null,"æš‚æ— å¸–å­ï¼Œå¿«æ¥å‘å¸ƒç¬¬ä¸€å¸–å§ï¼",-1)])])):c("",!0)]),k.value?(l(),o("div",{key:0,class:"modal-overlay",onClick:s[9]||(s[9]=t=>k.value=!1)},[e("div",{class:"modal-content",onClick:s[8]||(s[8]=C(()=>{},["stop"]))},[e("div",Xe,[s[24]||(s[24]=e("h2",null,"å‘å¸ƒæ–°å¸–å­",-1)),e("button",{class:"close-btn",onClick:s[4]||(s[4]=t=>k.value=!1)},"Ã—")]),e("div",Be,[e("div",Ee,[s[25]||(s[25]=e("label",null,"æ ‡é¢˜:",-1)),f(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>d.value.title=t),type:"text",placeholder:"è¾“å…¥å¸–å­æ ‡é¢˜",required:""},null,512),[[S,d.value.title]])]),e("div",Re,[s[26]||(s[26]=e("label",null,"å†…å®¹:",-1)),f(e("textarea",{"onUpdate:modelValue":s[6]||(s[6]=t=>d.value.content=t),placeholder:"åˆ†äº«ä½ çš„æ‘„å½±å¿ƒå¾—ã€ä½œå“æˆ–é—®é¢˜...",rows:"6",required:""},null,512),[[S,d.value.content]])]),e("div",qe,[s[27]||(s[27]=e("label",null,"å›¾ç‰‡ (å¯é€‰ï¼Œæœ€å¤š3å¼ ):",-1)),e("div",Fe,[e("input",{type:"file",accept:"image/*",multiple:"",onChange:ee,ref:"fileInput"},null,544),d.value.images.length>0?(l(),o("div",Je,[(l(!0),o(V,null,M(d.value.images,(t,v)=>(l(),o("div",{key:v,class:"preview-item"},[e("img",{src:t,alt:"é¢„è§ˆ"+(v+1)},null,8,Ke),e("button",{onClick:B=>se(v)},"Ã—",8,Oe)]))),128))])):c("",!0)])]),e("div",Ae,[e("button",{class:"cancel-btn",onClick:s[7]||(s[7]=t=>k.value=!1)},"å–æ¶ˆ"),e("button",{class:"confirm-btn",disabled:!H.value||$.value,onClick:te},n($.value?"å‘å¸ƒä¸­...":"å‘å¸ƒå¸–å­"),9,Ge)])])])])):c("",!0),F.value?(l(),o("div",{key:1,class:"modal-overlay",onClick:Q},[e("div",{class:"modal-content post-detail-modal",onClick:s[14]||(s[14]=C(()=>{},["stop"]))},[e("div",je,[e("h2",null,n(r.value?.title),1),e("button",{class:"close-btn",onClick:Q},"Ã—")]),e("div",He,[e("div",Qe,[e("div",We,[e("span",Ye,n(r.value?.username),1),e("span",Ze,n(O(r.value?.createTime)),1),e("div",es,[e("span",null,"ðŸ‘ï¸ "+n(r.value?.views),1),e("span",{class:ve(["like-btn",{liked:z.value}]),onClick:le}," ðŸ‘ "+n(r.value?.likes),3),e("span",null,"ðŸ’¬ "+n(r.value?.comments),1)])]),e("div",ss,n(r.value?.content),1),r.value?.images?(l(),o("div",ts,[(l(!0),o(V,null,M(JSON.parse(r.value.images),(t,v)=>(l(),o("img",{key:v,src:t,alt:"å›¾ç‰‡"+(v+1),onClick:B=>Z(t)},null,8,as))),128))])):c("",!0)]),e("div",ls,[e("h3",null,"è¯„è®º ("+n(G.value)+")",1),E(m).isLoggedIn?(l(),o("div",os,[f(e("textarea",{"onUpdate:modelValue":s[10]||(s[10]=t=>g.value.content=t),placeholder:"å†™ä¸‹ä½ çš„è¯„è®º...",rows:"3"},null,512),[[S,g.value.content]]),e("div",ns,[e("button",{class:"submit-comment",disabled:!g.value.content.trim()||U.value,onClick:oe},n(U.value?"æäº¤ä¸­...":"å‘è¡¨è¯„è®º"),9,is)])])):(l(),o("div",rs,[e("p",null,[s[28]||(s[28]=A("è¯· ",-1)),e("a",{href:"#",onClick:s[11]||(s[11]=C(t=>a.$router.push("/login"),["prevent"]))},"ç™»å½•"),s[29]||(s[29]=A(" åŽå‘è¡¨è¯„è®º",-1))])])),f((l(),o("div",us,[(l(!0),o(V,null,M(X.value,t=>(l(),o("div",{key:t.id,class:"comment-item"},[e("div",ds,[e("span",cs,n(t.username),1),e("span",vs,n(O(t.createTime)),1)]),e("div",ms,[t.replyToUsername?(l(),o("span",ps," @"+n(t.replyToUsername),1)):c("",!0),A(" "+n(t.content),1)]),e("div",_s,[E(m).isLoggedIn?(l(),o("button",{key:0,onClick:v=>ne(t),class:"reply-btn"}," å›žå¤ ",8,gs)):c("",!0),E(m).user?.role==="admin"?(l(),o("button",{key:1,onClick:v=>re(t.id),class:"delete-btn"}," åˆ é™¤ ",8,fs)):c("",!0)])]))),128)),X.value.length===0?(l(),o("div",ys," æš‚æ— è¯„è®ºï¼Œå¿«æ¥å‘è¡¨ä½ çš„çœ‹æ³•å§ï¼ ")):c("",!0)])),[[N,J.value]]),I.value>1?(l(),o("div",ks,[e("button",{disabled:p.value===1,onClick:s[12]||(s[12]=t=>Y(p.value-1))}," ä¸Šä¸€é¡µ ",8,hs),e("span",null,n(p.value)+" / "+n(I.value),1),e("button",{disabled:p.value===I.value,onClick:s[13]||(s[13]=t=>Y(p.value+1))}," ä¸‹ä¸€é¡µ ",8,bs)])):c("",!0)])])])])):c("",!0),h.value?(l(),o("div",{key:2,class:"modal-overlay",onClick:s[19]||(s[19]=t=>h.value=!1)},[e("div",{class:"modal-content",onClick:s[18]||(s[18]=C(()=>{},["stop"]))},[e("div",Cs,[e("h2",null,"å›žå¤ "+n(P.value?.username),1),e("button",{class:"close-btn",onClick:s[15]||(s[15]=t=>h.value=!1)},"Ã—")]),e("div",ws,[e("div",$s,[s[30]||(s[30]=e("label",null,"å›žå¤å†…å®¹:",-1)),f(e("textarea",{"onUpdate:modelValue":s[16]||(s[16]=t=>b.value=t),placeholder:"å†™ä¸‹ä½ çš„å›žå¤...",rows:"4",required:""},null,512),[[S,b.value]])]),e("div",Is,[e("button",{class:"cancel-btn",onClick:s[17]||(s[17]=t=>h.value=!1)},"å–æ¶ˆ"),e("button",{class:"confirm-btn",disabled:!b.value.trim()||T.value,onClick:ie},n(T.value?"æäº¤ä¸­...":"å›žå¤"),9,Us)])])])])):c("",!0),K.value?(l(),o("div",{key:3,class:"image-viewer",onClick:s[21]||(s[21]=t=>K.value=!1)},[e("img",{src:j.value,alt:"æŸ¥çœ‹å›¾ç‰‡",onClick:s[20]||(s[20]=C(()=>{},["stop"]))},null,8,Ps)])):c("",!0)])}}},Vs=ue(Ts,[["__scopeId","data-v-f431b2c1"]]);export{Vs as default};
