import{_ as Q,J as W,o as X,a as _,c as f,b as s,d as a,w as n,u as F,C as Y,F as Z,g as ee,h as x,x as b,E as c,q as I,e as d,B as se,r as h,j as te,L as ae,v as le,t as i,G as q,n as g}from"./main-BuGC26DR.js";const oe={class:"courses-container"},ne={class:"filter-section"},ie={class:"courses-grid"},de=["onClick"],re={class:"course-overlay"},ue={class:"course-info"},ce=["onClick"],pe={class:"course-meta"},ve={class:"duration"},me={class:"students"},_e={class:"course-footer"},fe={class:"teacher"},ye={class:"course-actions"},ge={key:0,class:"empty-state"},he={key:1,class:"pagination"},Ce={key:0,class:"course-detail"},be={class:"detail-cover"},Ve={class:"detail-info"},ke={class:"detail-meta"},we={class:"meta-item"},xe={class:"value"},ze={class:"meta-item"},Pe={class:"value"},Te={class:"meta-item"},Ue={class:"value"},Ne={class:"meta-item"},$e={class:"value"},De={class:"detail-description"},Fe={class:"detail-actions"},Ie={key:0,class:"purchase-info"},Be={class:"purchase-item"},Ee={class:"purchase-item"},Le={class:"price"},Re={class:"purchase-item"},Se={key:0,class:"purchase-item"},qe={class:"points-balance"},Me={class:"dialog-footer"},je={__name:"Courses",setup(Ge){te();const z=h(!1),U=h(!1),V=h(!1),k=h(!1),P=h([]),l=h(null),T=h(0),p=I({keyword:"",category:"",difficulty:null}),v=I({page:1,size:9,total:0}),r=I({payType:1,usePoints:0}),C=async()=>{z.value=!0;try{const o={page:v.page,size:v.size,keyword:p.keyword||void 0,category:p.category||void 0,difficulty:p.difficulty||void 0},e=await b.get("/course/list",{params:o}),{code:u,data:y}=e.data;u===200&&(P.value=y.list,v.total=y.total)}catch{c.error("加载课程失败")}finally{z.value=!1}},M=W(()=>{v.page=1,C()},500),B=o=>({1:"入门",2:"中级",3:"高级"})[o]||"未知",N=async o=>{try{const e=await b.get(`/course/detail/${o.id}`),{code:u,data:y}=e.data;u===200&&(l.value=y,V.value=!0)}catch{c.error("加载课程详情失败")}},E=async o=>{if(o.isFree===1)try{await b.post(`/course/learn/${o.id}`),c.success("开始学习"),V.value=!1,c.info("即将跳转到学习页面")}catch{c.error("操作失败")}else l.value=o,k.value=!0,V.value=!1,await j()},j=async()=>{try{const o=await b.get("/user/info"),{code:e,data:u}=o.data;e===200&&(T.value=u.points||0)}catch(o){console.error("加载用户积分失败:",o)}},G=async()=>{if(l.value){if(r.payType===3&&l.value.price*100-(r.usePoints||0)>T.value){c.error("积分不足");return}U.value=!0;try{const o=await b.post("/order/create",null,{params:{itemId:l.value.id,itemType:1,itemName:l.value.title,itemImage:l.value.coverImage,price:l.value.price,payType:r.payType,usePoints:r.usePoints||0}}),{code:e,message:u,data:y}=o.data;e===200?(c.success(u||"订单创建成功"),(await b.post(`/order/pay/${y.id}`)).data.code===200&&(c.success("支付成功！"),k.value=!1,r.payType=1,r.usePoints=0,C())):c.error(u||"购买失败")}catch{c.error("购买失败，请稍后重试")}finally{U.value=!1}}};return X(()=>{C()}),(o,e)=>{const u=d("el-icon"),y=d("el-input"),m=d("el-option"),L=d("el-select"),R=d("el-image"),w=d("el-button"),J=d("el-empty"),A=d("el-pagination"),S=d("el-dialog"),$=d("el-radio"),H=d("el-radio-group"),K=d("el-input-number"),O=se("loading");return _(),f("div",oe,[e[26]||(e[26]=s("div",{class:"page-header"},[s("h2",null,"摄影课程")],-1)),s("div",ne,[a(y,{modelValue:p.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>p.keyword=t),placeholder:"搜索课程标题、描述",style:{width:"300px"},onInput:F(M)},{prefix:n(()=>[a(u,null,{default:n(()=>[a(F(ae))]),_:1})]),_:1},8,["modelValue","onInput"]),a(L,{modelValue:p.category,"onUpdate:modelValue":e[1]||(e[1]=t=>p.category=t),placeholder:"选择分类",clearable:"",onChange:C,style:{"margin-left":"10px"}},{default:n(()=>[a(m,{label:"基础入门",value:"basic"}),a(m,{label:"人像摄影",value:"portrait"}),a(m,{label:"风景摄影",value:"landscape"}),a(m,{label:"后期处理",value:"post"}),a(m,{label:"器材使用",value:"equipment"})]),_:1},8,["modelValue"]),a(L,{modelValue:p.difficulty,"onUpdate:modelValue":e[2]||(e[2]=t=>p.difficulty=t),placeholder:"难度等级",clearable:"",onChange:C,style:{"margin-left":"10px"}},{default:n(()=>[a(m,{label:"入门",value:1}),a(m,{label:"中级",value:2}),a(m,{label:"高级",value:3})]),_:1},8,["modelValue"])]),Y((_(),f("div",ie,[(_(!0),f(Z,null,ee(P.value,t=>(_(),f("div",{key:t.id,class:"course-card"},[s("div",{class:"course-cover",onClick:D=>N(t)},[a(R,{src:t.coverImage,fit:"cover",style:{width:"100%",height:"100%"}},null,8,["src"]),s("div",re,[a(u,null,{default:n(()=>[a(F(le))]),_:1})])],8,de),s("div",ue,[s("div",{class:"course-title",onClick:D=>N(t)},i(t.title),9,ce),s("div",pe,[s("span",{class:q(["difficulty","level-"+t.difficulty])},i(B(t.difficulty)),3),s("span",ve,i(t.duration)+"分钟",1),s("span",me,i(t.studentCount)+"人学习",1)]),s("div",_e,[s("span",fe,"讲师："+i(t.teacherName),1),s("span",{class:q(["price",{free:t.isFree===1}])},i(t.isFree===1?"免费":"¥"+t.price),3)]),s("div",ye,[a(w,{type:"primary",size:"small",onClick:D=>N(t)},{default:n(()=>[...e[11]||(e[11]=[g(" 查看详情 ",-1)])]),_:1},8,["onClick"]),a(w,{type:"success",size:"small",onClick:D=>E(t)},{default:n(()=>[g(i(t.isFree===1?"开始学习":"立即购买"),1)]),_:2},1032,["onClick"])])])]))),128))])),[[O,z.value]]),P.value.length===0&&!z.value?(_(),f("div",ge,[a(J,{description:"暂无课程，敬请期待！"})])):x("",!0),P.value.length>0?(_(),f("div",he,[a(A,{"current-page":v.page,"onUpdate:currentPage":e[3]||(e[3]=t=>v.page=t),"page-size":v.size,"onUpdate:pageSize":e[4]||(e[4]=t=>v.size=t),total:v.total,onCurrentChange:C},null,8,["current-page","page-size","total"])])):x("",!0),a(S,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=t=>V.value=t),title:l.value?.title,width:"800px","destroy-on-close":""},{default:n(()=>[l.value?(_(),f("div",Ce,[s("div",be,[a(R,{src:l.value.coverImage,fit:"contain",style:{width:"100%",height:"300px","border-radius":"8px"}},null,8,["src"])]),s("div",Ve,[s("div",ke,[s("div",we,[e[12]||(e[12]=s("span",{class:"label"},"难度：",-1)),s("span",xe,i(B(l.value.difficulty)),1)]),s("div",ze,[e[13]||(e[13]=s("span",{class:"label"},"时长：",-1)),s("span",Pe,i(l.value.duration)+"分钟",1)]),s("div",Te,[e[14]||(e[14]=s("span",{class:"label"},"学习人数：",-1)),s("span",Ue,i(l.value.studentCount)+"人",1)]),s("div",Ne,[e[15]||(e[15]=s("span",{class:"label"},"讲师：",-1)),s("span",$e,i(l.value.teacherName),1)])]),s("div",De,[e[16]||(e[16]=s("h4",null,"课程介绍",-1)),s("p",null,i(l.value.description),1)]),s("div",Fe,[a(w,{type:"primary",size:"large",onClick:e[5]||(e[5]=t=>E(l.value))},{default:n(()=>[g(i(l.value.isFree===1?"开始学习":"立即购买 - ¥"+l.value.price),1)]),_:1})])])])):x("",!0)]),_:1},8,["modelValue","title"]),a(S,{modelValue:k.value,"onUpdate:modelValue":e[10]||(e[10]=t=>k.value=t),title:"确认购买",width:"500px"},{footer:n(()=>[s("span",Me,[a(w,{onClick:e[9]||(e[9]=t=>k.value=!1)},{default:n(()=>[...e[24]||(e[24]=[g("取消",-1)])]),_:1}),a(w,{type:"primary",onClick:G,loading:U.value},{default:n(()=>[...e[25]||(e[25]=[g(" 确认支付 ",-1)])]),_:1},8,["loading"])])]),default:n(()=>[l.value?(_(),f("div",Ie,[s("div",Be,[e[17]||(e[17]=s("span",null,"课程名称：",-1)),s("span",null,i(l.value.title),1)]),s("div",Ee,[e[18]||(e[18]=s("span",null,"课程价格：",-1)),s("span",Le,"¥"+i(l.value.price),1)]),s("div",Re,[e[22]||(e[22]=s("span",null,"支付方式：",-1)),a(H,{modelValue:r.payType,"onUpdate:modelValue":e[7]||(e[7]=t=>r.payType=t)},{default:n(()=>[a($,{label:1},{default:n(()=>[...e[19]||(e[19]=[g("微信支付",-1)])]),_:1}),a($,{label:2},{default:n(()=>[...e[20]||(e[20]=[g("支付宝",-1)])]),_:1}),a($,{label:3},{default:n(()=>[...e[21]||(e[21]=[g("积分支付",-1)])]),_:1})]),_:1},8,["modelValue"])]),r.payType===3?(_(),f("div",Se,[e[23]||(e[23]=s("span",null,"使用积分：",-1)),a(K,{modelValue:r.usePoints,"onUpdate:modelValue":e[8]||(e[8]=t=>r.usePoints=t),min:0,max:T.value,step:10,size:"small"},null,8,["modelValue","max"]),s("span",qe,"可用："+i(T.value),1)])):x("",!0)])):x("",!0)]),_:1},8,["modelValue"])])}}},Ae=Q(je,[["__scopeId","data-v-228daa9d"]]);export{Ae as default};
