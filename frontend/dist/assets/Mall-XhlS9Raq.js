import{_ as Q,o as W,a as o,c as n,b as e,u as K,t as l,h as r,C as m,M as C,N as Y,F as P,g as U,i as E,n as X,x as w,E as h,r as i,B as Z,I as ee,G as q}from"./main-BuGC26DR.js";import{u as se}from"./user-Cw0ViDKc.js";const te={class:"mall"},ae={class:"header"},le={key:0,class:"user-points"},oe={class:"points"},ne={class:"filter-section"},ie={class:"search-box"},de={class:"category-filter"},re=["onClick"],ue={class:"products-grid"},ce=["onClick"],ve={class:"product-image"},pe=["src","alt"],ge={key:0,class:"stock-badge"},_e={class:"product-info"},me={class:"desc"},he={class:"price-section"},fe={class:"points"},ke={class:"stock"},ye=["disabled","onClick"],be={key:0,class:"empty-state"},xe={key:1,class:"pagination"},Ce=["disabled"],we=["disabled"],Ie={class:"modal-header"},$e={class:"modal-body"},Le={class:"product-detail-image"},De=["src","alt"],Me={class:"product-detail-info"},Pe={class:"description"},Ue={class:"detail-price"},Ee={class:"points"},Ne={class:"stock"},Ve={class:"detail-category"},ze=["disabled"],Se={class:"modal-header"},Te={class:"modal-body"},Be={class:"exchange-summary"},Fe={key:0,class:"error-text"},Ke={class:"exchange-form"},Xe={class:"form-group"},qe={class:"form-group"},Re={class:"form-group"},Ge={class:"modal-actions"},je=["disabled"],Ae={key:4,class:"exchange-records"},He={class:"records-list"},Je={class:"record-info"},Oe={class:"record-meta"},Qe={key:0,class:"record-address"},We={key:1,class:"record-remark"},Ye={key:0,class:"empty-records"},Ze={__name:"Mall",setup(es){const c=se(),I=i([]),b=i(!1),v=i(1),f=i(1),R=i(0),$=i(""),L=i(""),u=i(null),x=i(!1),g=i(!1),p=i(null),d=i({address:"",phone:"",remark:""}),k=i(!1),y=i(0),D=i([]),M=i(!1),G=[{label:"全部",value:""},{label:"摄影器材",value:"器材"},{label:"后期软件",value:"软件"},{label:"摄影课程",value:"课程"},{label:"周边商品",value:"周边"}],N=ee(()=>d.value.address&&d.value.phone&&p.value&&y.value>=p.value.points),_=async()=>{try{b.value=!0;const a={page:v.value,size:12,keyword:$.value,category:L.value},s=await w.get("/api/product/list",{params:a});s.data.code===200&&(I.value=s.data.data.list,f.value=s.data.data.pages,R.value=s.data.data.total)}catch{h.error("加载商品失败")}finally{b.value=!1}},V=async()=>{if(c.isLoggedIn)try{const a=await w.get("/api/point/balance",{headers:{"X-User-Id":c.user.id}});a.data.code===200&&(y.value=a.data.data)}catch(a){console.error("加载积分失败:",a)}},z=async()=>{if(c.isLoggedIn)try{M.value=!0;const a=await w.get("/api/exchange/list",{headers:{"X-User-Id":c.user.id},params:{page:1,size:10}});a.data.code===200&&(D.value=a.data.data.list)}catch{h.error("加载兑换记录失败")}finally{M.value=!1}},j=a=>{L.value=a,v.value=1,_()},S=a=>{a>=1&&a<=f.value&&(v.value=a,_())},A=a=>{u.value=a,x.value=!0},T=a=>{if(!c.isLoggedIn){h.warning("请先登录");return}p.value=a,g.value=!0},H=async()=>{if(!(!N.value||k.value))try{k.value=!0;const a=await w.post("/api/exchange/create",{productId:p.value.id,address:d.value.address,phone:d.value.phone,remark:d.value.remark},{headers:{"X-User-Id":c.user.id}});a.data.code===200?(h.success("兑换成功！"),g.value=!1,d.value={address:"",phone:"",remark:""},_(),V(),z()):h.error(a.data.message||"兑换失败")}catch{h.error("兑换失败，请稍后重试")}finally{k.value=!1}},J=a=>{if(!a)return"";const s=new Date(a);return s.toLocaleDateString("zh-CN")+" "+s.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})},O=a=>({0:"待处理",1:"已发货",2:"已完成",3:"已取消"})[a]||"未知";return W(()=>{_(),c.isLoggedIn&&(V(),z())}),(a,s)=>{const B=Z("loading");return o(),n("div",te,[e("header",ae,[s[14]||(s[14]=e("h1",null,"积分商城",-1)),K(c).isLoggedIn?(o(),n("div",le,[e("span",oe,"我的积分: "+l(y.value),1)])):r("",!0)]),e("div",ne,[e("div",ie,[m(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>$.value=t),placeholder:"搜索商品...",onKeyup:Y(_,["enter"])},null,544),[[C,$.value]]),e("button",{onClick:_},"搜索")]),e("div",de,[(o(),n(P,null,U(G,t=>e("span",{key:t.value,class:q({active:L.value===t.value}),onClick:F=>j(t.value)},l(t.label),11,re)),64))])]),m((o(),n("div",ue,[(o(!0),n(P,null,U(I.value,t=>(o(),n("div",{key:t.id,class:"product-card",onClick:F=>A(t)},[e("div",ve,[e("img",{src:t.image||"/default-product.png",alt:t.name},null,8,pe),t.stock<=0?(o(),n("div",ge,"已售罄")):r("",!0)]),e("div",_e,[e("h3",null,l(t.name),1),e("p",me,l(t.description),1),e("div",he,[e("span",fe,l(t.points)+" 积分",1),e("span",ke,"库存: "+l(t.stock),1)]),e("button",{class:"exchange-btn",disabled:t.stock<=0,onClick:E(F=>T(t),["stop"])}," 立即兑换 ",8,ye)])],8,ce))),128))])),[[B,b.value]]),I.value.length===0&&!b.value?(o(),n("div",be,[...s[15]||(s[15]=[e("p",null,"暂无商品",-1)])])):r("",!0),f.value>1?(o(),n("div",xe,[e("button",{disabled:v.value===1,onClick:s[1]||(s[1]=t=>S(v.value-1))}," 上一页 ",8,Ce),e("span",null,l(v.value)+" / "+l(f.value),1),e("button",{disabled:v.value===f.value,onClick:s[2]||(s[2]=t=>S(v.value+1))}," 下一页 ",8,we)])):r("",!0),x.value?(o(),n("div",{key:2,class:"modal-overlay",onClick:s[6]||(s[6]=t=>x.value=!1)},[e("div",{class:"modal-content",onClick:s[5]||(s[5]=E(()=>{},["stop"]))},[e("div",Ie,[e("h2",null,l(u.value?.name),1),e("button",{class:"close-btn",onClick:s[3]||(s[3]=t=>x.value=!1)},"×")]),e("div",$e,[e("div",Le,[e("img",{src:u.value?.image||"/default-product.png",alt:u.value?.name},null,8,De)]),e("div",Me,[e("p",Pe,l(u.value?.description),1),e("div",Ue,[e("span",Ee,l(u.value?.points)+" 积分",1),e("span",Ne,"库存: "+l(u.value?.stock),1)]),e("div",Ve,"分类: "+l(u.value?.category),1),e("button",{class:"exchange-btn",disabled:u.value?.stock<=0,onClick:s[4]||(s[4]=t=>T(u.value))}," 立即兑换 ",8,ze)])])])])):r("",!0),g.value?(o(),n("div",{key:3,class:"modal-overlay",onClick:s[13]||(s[13]=t=>g.value=!1)},[e("div",{class:"modal-content",onClick:s[12]||(s[12]=E(()=>{},["stop"]))},[e("div",Se,[s[16]||(s[16]=e("h2",null,"确认兑换",-1)),e("button",{class:"close-btn",onClick:s[7]||(s[7]=t=>g.value=!1)},"×")]),e("div",Te,[e("div",Be,[e("h3",null,l(p.value?.name),1),e("p",null,[s[17]||(s[17]=X("所需积分: ",-1)),e("strong",null,l(p.value?.points)+" 分",1)]),e("p",null,[s[18]||(s[18]=X("当前积分: ",-1)),e("strong",null,l(y.value)+" 分",1)]),y.value<p.value?.points?(o(),n("p",Fe," 积分不足！ ")):r("",!0)]),e("div",Ke,[e("div",Xe,[s[19]||(s[19]=e("label",null,"收货地址:",-1)),m(e("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>d.value.address=t),type:"text",placeholder:"请输入详细收货地址",required:""},null,512),[[C,d.value.address]])]),e("div",qe,[s[20]||(s[20]=e("label",null,"联系电话:",-1)),m(e("input",{"onUpdate:modelValue":s[9]||(s[9]=t=>d.value.phone=t),type:"tel",placeholder:"请输入联系电话",required:""},null,512),[[C,d.value.phone]])]),e("div",Re,[s[21]||(s[21]=e("label",null,"备注 (可选):",-1)),m(e("textarea",{"onUpdate:modelValue":s[10]||(s[10]=t=>d.value.remark=t),placeholder:"如有特殊要求，请在此说明"},null,512),[[C,d.value.remark]])])]),e("div",Ge,[e("button",{class:"cancel-btn",onClick:s[11]||(s[11]=t=>g.value=!1)},"取消"),e("button",{class:"confirm-btn",disabled:!N.value||k.value,onClick:H},l(k.value?"提交中...":"确认兑换"),9,je)])])])])):r("",!0),K(c).isLoggedIn?(o(),n("div",Ae,[s[22]||(s[22]=e("h2",null,"我的兑换记录",-1)),m((o(),n("div",He,[(o(!0),n(P,null,U(D.value,t=>(o(),n("div",{key:t.id,class:"record-item"},[e("div",Je,[e("h4",null,l(t.productName),1),e("p",Oe,[e("span",null,l(t.points)+" 积分",1),e("span",null,l(J(t.createTime)),1),e("span",{class:q(["status","status-"+t.status])},l(O(t.status)),3)]),t.address?(o(),n("p",Qe,l(t.address)+" - "+l(t.phone),1)):r("",!0),t.remark?(o(),n("p",We," 备注: "+l(t.remark),1)):r("",!0)])]))),128)),D.value.length===0?(o(),n("div",Ye," 暂无兑换记录 ")):r("",!0)])),[[B,M.value]])])):r("",!0)])}}},as=Q(Ze,[["__scopeId","data-v-8ff9ff42"]]);export{as as default};
