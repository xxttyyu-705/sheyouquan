import{_ as pe,o as me,A as _e,a as m,c as f,b as s,d as e,w as o,x as $,E as d,r as i,e as r,B as ve,n as u,t as c,C as W,D as H,G as fe,F as G,g as j,u as z,H as ge,z as be,f as he,h as q,I as ye}from"./main-BuGC26DR.js";const Fe={class:"profile-container"},we={class:"profile-card"},ke={class:"info-section"},Ve={class:"avatar-upload"},Ce={class:"points-section"},xe={class:"points-summary"},Ie={class:"current-points"},Te={class:"value"},Ue={class:"pagination"},ze={class:"works-section"},Ne={class:"works-grid"},Ae={class:"work-content"},Be={class:"work-title"},Me={class:"work-stats"},Se={key:0,class:"empty-state"},Ee={class:"courses-section"},Pe={class:"course-info"},Re={class:"course-title"},De={class:"course-progress"},Le={class:"course-actions"},Oe={key:0,class:"empty-state"},$e={class:"orders-section"},We={__name:"Profile",setup(He){const F=i("info"),w=i(!1),k=i(),h=i({username:"",nickname:"",email:"",phone:"",gender:0,signature:"",location:"",points:0,avatar:""}),n=i({}),J={nickname:[{max:50,message:"昵称长度不能超过50个字符",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},N=i([]),V=i(!1),A=i(1),B=i(10),M=i(0),C=i([]),x=i([]),S=i([]),I=i(!1),K=ye(()=>{const l=localStorage.getItem("token");return l?{Authorization:`Bearer ${l}`}:{}}),E=async()=>{try{const l=await $.get("/user/info"),{code:t,data:_}=l.data;t===200&&(h.value=_,n.value={..._})}catch{d.error("加载用户信息失败")}},P=async()=>{k.value&&await k.value.validate(async l=>{if(l){w.value=!0;try{const t=await $.put("/user/info",n.value),{code:_,message:g}=t.data;_===200?(d.success(g||"更新成功"),await E()):d.error(g||"更新失败")}catch{d.error("更新失败，请稍后重试")}finally{w.value=!1}}})},Q=l=>{l.code===200?(n.value.avatar=l.data.url,P()):d.error(l.message||"头像上传失败")},X=l=>{const t=l.type.startsWith("image/"),_=l.size/1024/1024<2;return t?_?!0:(d.error("头像图片大小不能超过 2MB!"),!1):(d.error("只能上传图片文件!"),!1)},R=async()=>{V.value=!0;try{N.value=[{description:"注册用户",points:10,balance:10,createTime:"2024-01-01 10:00:00"},{description:"发布作品",points:5,balance:15,createTime:"2024-01-02 14:30:00"},{description:"每日签到",points:5,balance:20,createTime:"2024-01-03 09:00:00"}],M.value=3}catch{d.error("加载积分记录失败")}finally{V.value=!1}},Y=async()=>{try{C.value=[{id:1,title:"晨曦初照",coverImage:"https://via.placeholder.com/300x200/409EFF/FFFFFF?text=作品1",viewCount:120,likeCount:25,commentCount:8},{id:2,title:"城市夜景",coverImage:"https://via.placeholder.com/300x200/67C23A/FFFFFF?text=作品2",viewCount:85,likeCount:18,commentCount:5}]}catch{d.error("加载作品失败")}},Z=async()=>{try{x.value=[{id:1,title:"摄影入门基础",coverImage:"https://via.placeholder.com/300x200/E6A23C/FFFFFF?text=课程1",progress:65},{id:2,title:"人像摄影技巧",coverImage:"https://via.placeholder.com/300x200/F56C6C/FFFFFF?text=课程2",progress:30}]}catch{d.error("加载课程失败")}},ee=async()=>{I.value=!0;try{S.value=[{orderNo:"20240101123456",itemName:"人像摄影技巧课程",amount:199,status:1,createTime:"2024-01-01 12:34:56"},{orderNo:"20240102234567",itemName:"摄影技巧手册",amount:800,status:2,createTime:"2024-01-02 23:45:67"}]}catch{d.error("加载订单失败")}finally{I.value=!1}},te=l=>{d.info(`继续学习: ${l.title}`)},ae=l=>({0:"info",1:"success",2:"warning",3:"danger"})[l]||"info",oe=l=>({0:"待支付",1:"已支付",2:"已取消",3:"已退款"})[l]||"未知";me(()=>{E()});const le=l=>{l==="points"?R():l==="works"?Y():l==="courses"?Z():l==="orders"&&ee()};return _e(F,l=>{le(l)}),(l,t)=>{const _=r("el-avatar"),g=r("el-button"),se=r("el-upload"),b=r("el-input"),v=r("el-form-item"),T=r("el-radio"),ne=r("el-radio-group"),re=r("el-form"),y=r("el-tab-pane"),p=r("el-table-column"),D=r("el-table"),ie=r("el-pagination"),L=r("el-image"),U=r("el-icon"),de=r("el-progress"),ue=r("el-tag"),ce=r("el-tabs"),O=ve("loading");return m(),f("div",Fe,[s("div",we,[e(ce,{modelValue:F.value,"onUpdate:modelValue":t[9]||(t[9]=a=>F.value=a),class:"profile-tabs"},{default:o(()=>[e(y,{name:"info",label:"个人信息"},{default:o(()=>[s("div",ke,[s("div",Ve,[e(_,{size:100,src:h.value.avatar},{default:o(()=>[u(c(h.value.nickname?.charAt(0)||h.value.username?.charAt(0)),1)]),_:1},8,["src"]),e(se,{class:"upload-trigger",action:"/api/file/upload",headers:K.value,"show-file-list":!1,"on-success":Q,"before-upload":X},{default:o(()=>[e(g,{type:"text",size:"small"},{default:o(()=>[...t[10]||(t[10]=[u("更换头像",-1)])]),_:1})]),_:1},8,["headers"])]),e(re,{ref_key:"infoFormRef",ref:k,model:n.value,rules:J,"label-width":"100px",class:"info-form"},{default:o(()=>[e(v,{label:"用户名",prop:"username"},{default:o(()=>[e(b,{modelValue:n.value.username,"onUpdate:modelValue":t[0]||(t[0]=a=>n.value.username=a),disabled:""},null,8,["modelValue"])]),_:1}),e(v,{label:"昵称",prop:"nickname"},{default:o(()=>[e(b,{modelValue:n.value.nickname,"onUpdate:modelValue":t[1]||(t[1]=a=>n.value.nickname=a),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),e(v,{label:"邮箱",prop:"email"},{default:o(()=>[e(b,{modelValue:n.value.email,"onUpdate:modelValue":t[2]||(t[2]=a=>n.value.email=a),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),e(v,{label:"手机号",prop:"phone"},{default:o(()=>[e(b,{modelValue:n.value.phone,"onUpdate:modelValue":t[3]||(t[3]=a=>n.value.phone=a),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),e(v,{label:"性别",prop:"gender"},{default:o(()=>[e(ne,{modelValue:n.value.gender,"onUpdate:modelValue":t[4]||(t[4]=a=>n.value.gender=a)},{default:o(()=>[e(T,{label:0},{default:o(()=>[...t[11]||(t[11]=[u("未知",-1)])]),_:1}),e(T,{label:1},{default:o(()=>[...t[12]||(t[12]=[u("男",-1)])]),_:1}),e(T,{label:2},{default:o(()=>[...t[13]||(t[13]=[u("女",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"个性签名",prop:"signature"},{default:o(()=>[e(b,{modelValue:n.value.signature,"onUpdate:modelValue":t[5]||(t[5]=a=>n.value.signature=a),type:"textarea",rows:3,placeholder:"介绍一下自己...",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(v,{label:"所在地",prop:"location"},{default:o(()=>[e(b,{modelValue:n.value.location,"onUpdate:modelValue":t[6]||(t[6]=a=>n.value.location=a),placeholder:"请输入所在地"},null,8,["modelValue"])]),_:1}),e(v,null,{default:o(()=>[e(g,{type:"primary",onClick:P,loading:w.value},{default:o(()=>[...t[14]||(t[14]=[u(" 保存修改 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])]),_:1}),e(y,{name:"points",label:"积分记录"},{default:o(()=>[s("div",Ce,[s("div",xe,[s("div",Ie,[t[15]||(t[15]=s("span",{class:"label"},"当前积分",-1)),s("span",Te,c(h.value.points||0),1)])]),W((m(),H(D,{data:N.value,style:{width:"100%"}},{default:o(()=>[e(p,{prop:"description",label:"说明","min-width":"200"}),e(p,{prop:"points",label:"积分",width:"120"},{default:o(({row:a})=>[s("span",{class:fe(a.points>0?"points-add":"points-deduct")},c(a.points>0?"+":"")+c(a.points),3)]),_:1}),e(p,{prop:"balance",label:"余额",width:"100"}),e(p,{prop:"createTime",label:"时间",width:"180"})]),_:1},8,["data"])),[[O,V.value]]),s("div",Ue,[e(ie,{"current-page":A.value,"onUpdate:currentPage":t[7]||(t[7]=a=>A.value=a),"page-size":B.value,"onUpdate:pageSize":t[8]||(t[8]=a=>B.value=a),total:M.value,onCurrentChange:R},null,8,["current-page","page-size","total"])])])]),_:1}),e(y,{name:"works",label:"我的作品"},{default:o(()=>[s("div",ze,[s("div",Ne,[(m(!0),f(G,null,j(C.value,a=>(m(),f("div",{key:a.id,class:"work-card"},[e(L,{src:a.coverImage,fit:"cover",class:"work-cover"},null,8,["src"]),s("div",Ae,[s("div",Be,c(a.title),1),s("div",Me,[s("span",null,[e(U,null,{default:o(()=>[e(z(ge))]),_:1}),u(" "+c(a.viewCount),1)]),s("span",null,[e(U,null,{default:o(()=>[e(z(be))]),_:1}),u(" "+c(a.likeCount),1)]),s("span",null,[e(U,null,{default:o(()=>[e(z(he))]),_:1}),u(" "+c(a.commentCount),1)])])])]))),128))]),C.value.length===0?(m(),f("div",Se," 暂无作品，去发布一个吧！ ")):q("",!0)])]),_:1}),e(y,{name:"courses",label:"我的课程"},{default:o(()=>[s("div",Ee,[(m(!0),f(G,null,j(x.value,a=>(m(),f("div",{key:a.id,class:"course-item"},[e(L,{src:a.coverImage,fit:"cover",class:"course-cover"},null,8,["src"]),s("div",Pe,[s("div",Re,c(a.title),1),s("div",De,[e(de,{percentage:a.progress,"stroke-width":8},null,8,["percentage"])]),s("div",Le,[e(g,{type:"primary",size:"small",onClick:Ge=>te(a)},{default:o(()=>[...t[16]||(t[16]=[u(" 继续学习 ",-1)])]),_:1},8,["onClick"])])])]))),128)),x.value.length===0?(m(),f("div",Oe," 暂无已购课程 ")):q("",!0)])]),_:1}),e(y,{name:"orders",label:"我的订单"},{default:o(()=>[s("div",$e,[W((m(),H(D,{data:S.value,style:{width:"100%"}},{default:o(()=>[e(p,{prop:"orderNo",label:"订单号",width:"180"}),e(p,{prop:"itemName",label:"商品名称","min-width":"200"}),e(p,{prop:"amount",label:"金额",width:"100"},{default:o(({row:a})=>[u(" ¥"+c(a.amount),1)]),_:1}),e(p,{prop:"status",label:"状态",width:"100"},{default:o(({row:a})=>[e(ue,{type:ae(a.status)},{default:o(()=>[u(c(oe(a.status)),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"createTime",label:"创建时间",width:"180"})]),_:1},8,["data"])),[[O,I.value]])])]),_:1})]),_:1},8,["modelValue"])])])}}},qe=pe(We,[["__scopeId","data-v-bd9bfcac"]]);export{qe as default};
