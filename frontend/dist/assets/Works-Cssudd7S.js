import{_ as me,J as ge,o as ve,a as u,c as _,b as i,d as t,w as a,u as k,C as _e,F as B,g as F,h as w,x as I,E as f,r as V,e as d,q as O,B as fe,K,n as m,L as ye,t as g,H as he,z as R,f as ke,D as T,I as be}from"./main-BuGC26DR.js";const we={class:"works-container"},Ve={class:"page-header"},Ie={class:"filter-section"},Ce={class:"works-grid"},xe=["onClick"],Ue={class:"work-overlay"},Se={class:"work-info"},ze={class:"work-title"},qe={class:"work-author"},Te={class:"work-stats"},Ne={key:0,class:"empty-state"},$e={key:1,class:"pagination"},De=["src"],Pe={class:"dialog-footer"},Be={key:0,class:"work-detail"},Fe={class:"detail-images"},Oe={class:"detail-info"},Re={class:"detail-header"},Je={class:"author-info"},Le={class:"author-name"},We={class:"detail-time"},Ae={class:"detail-actions"},Ee={class:"detail-content"},Me={class:"description"},He={class:"meta-info"},Ke={key:0},je={key:1},Ge={key:2},Qe={key:3},Xe={key:0,class:"tags"},Ye={__name:"Works",setup(Ze){const N=V(!1),$=V(!1),S=V(!1),D=V(!1),b=V([]),s=V(null),z=V(),C=V([]),x=O({keyword:"",category:""}),h=O({page:1,size:12,total:0}),o=O({title:"",description:"",categoryId:null,tags:"",equipment:"",settings:"",location:"",shootTime:"",coverImage:"",images:"",isPublic:1}),j={title:[{required:!0,message:"请输入作品标题",trigger:"blur"},{min:2,max:100,message:"标题长度在2-100个字符之间",trigger:"blur"}],description:[{required:!0,message:"请输入作品描述",trigger:"blur"}],categoryId:[{required:!0,message:"请选择作品分类",trigger:"change"}],coverImage:[{required:!0,message:"请上传封面图",trigger:"change"}]},J=be(()=>{const n=localStorage.getItem("token");return n?{Authorization:`Bearer ${n}`}:{}}),q=async()=>{N.value=!0;try{const n={page:h.page,size:h.size,keyword:x.keyword||void 0,categoryId:x.category||void 0},e=await I.get("/work/list",{params:n}),{code:c,data:p}=e.data;c===200&&(b.value=p.list,h.total=p.total)}catch{f.error("加载作品失败")}finally{N.value=!1}},G=ge(()=>{h.page=1,q()},500),Q=n=>{n.code===200?(o.coverImage=n.data.url,f.success("封面上传成功")):f.error(n.message||"封面上传失败")},X=(n,e)=>{n.code===200&&(C.value.push({name:e.name,url:n.data.url}),L())},Y=n=>{C.value=C.value.filter(e=>e.uid!==n.uid),L()};function L(){const n=C.value.map(e=>e.url);o.images=JSON.stringify(n)}const W=n=>{const e=n.type.startsWith("image/"),c=n.size/1024/1024<5;return e?c?!0:(f.error("图片大小不能超过 5MB!"),!1):(f.error("只能上传图片文件!"),!1)},Z=async()=>{z.value&&await z.value.validate(async n=>{if(n){$.value=!0;try{const e=o.tags.split(",").map(U=>U.trim()).filter(U=>U),c={...o,tags:JSON.stringify(e),shootTime:o.shootTime?new Date(o.shootTime).toISOString():null},p=await I.post("/work/publish",c),{code:v,message:r}=p.data;v===200?(f.success(r||"发布成功"),S.value=!1,A(),q()):f.error(r||"发布失败")}catch{f.error("发布失败，请稍后重试")}finally{$.value=!1}}})};function A(){o.title="",o.description="",o.categoryId=null,o.tags="",o.equipment="",o.settings="",o.location="",o.shootTime="",o.coverImage="",o.images="",o.isPublic=1,C.value=[],z.value&&z.value.resetFields()}const ee=async n=>{try{const e=await I.get(`/work/detail/${n.id}`),{code:c,data:p}=e.data;c===200&&(s.value=p,D.value=!0)}catch{f.error("加载作品详情失败")}},te=async n=>{try{const e=await I.post(`/work/like/${n.id}`),{code:c,message:p}=e.data;if(c===200){if(f.success(p||"操作成功"),s.value){const r=await I.get(`/work/detail/${s.value.id}`);r.data.code===200&&(s.value=r.data.data)}const v=b.value.findIndex(r=>r.id===n.id);v!==-1&&(b.value[v].likeCount+=1)}}catch{f.error("操作失败")}},le=async n=>{try{const e=await I.post(`/work/collect/${n.id}`),{code:c,message:p}=e.data;if(c===200){if(f.success(p||"操作成功"),s.value){const r=await I.get(`/work/detail/${s.value.id}`);r.data.code===200&&(s.value=r.data.data)}const v=b.value.findIndex(r=>r.id===n.id);v!==-1&&(b.value[v].collectCount+=1)}}catch{f.error("操作失败")}};return ve(()=>{q()}),(n,e)=>{const c=d("el-icon"),p=d("el-button"),v=d("el-input"),r=d("el-option"),U=d("el-select"),P=d("el-image"),ae=d("el-empty"),oe=d("el-pagination"),y=d("el-form-item"),se=d("el-date-picker"),E=d("el-upload"),M=d("el-radio"),ne=d("el-radio-group"),ie=d("el-form"),H=d("el-dialog"),re=d("el-carousel-item"),ue=d("el-carousel"),de=d("el-avatar"),ce=d("el-tag"),pe=fe("loading");return u(),_("div",we,[i("div",Ve,[e[20]||(e[20]=i("h2",null,"摄影作品",-1)),t(p,{type:"primary",onClick:e[0]||(e[0]=l=>S.value=!0)},{default:a(()=>[t(c,null,{default:a(()=>[t(k(K))]),_:1}),e[19]||(e[19]=m("发布作品 ",-1))]),_:1})]),i("div",Ie,[t(v,{modelValue:x.keyword,"onUpdate:modelValue":e[1]||(e[1]=l=>x.keyword=l),placeholder:"搜索作品标题、描述",style:{width:"300px"},onInput:k(G)},{prefix:a(()=>[t(c,null,{default:a(()=>[t(k(ye))]),_:1})]),_:1},8,["modelValue","onInput"]),t(U,{modelValue:x.category,"onUpdate:modelValue":e[2]||(e[2]=l=>x.category=l),placeholder:"选择分类",clearable:"",onChange:q,style:{"margin-left":"10px"}},{default:a(()=>[t(r,{label:"人像",value:"portrait"}),t(r,{label:"风景",value:"landscape"}),t(r,{label:"街拍",value:"street"}),t(r,{label:"纪实",value:"documentary"}),t(r,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_e((u(),_("div",Ce,[(u(!0),_(B,null,F(b.value,l=>(u(),_("div",{key:l.id,class:"work-card",onClick:et=>ee(l)},[t(P,{src:l.coverImage,fit:"cover",class:"work-image"},null,8,["src"]),i("div",Ue,[i("div",Se,[i("div",ze,g(l.title),1),i("div",qe,g(l.authorNickname),1),i("div",Te,[i("span",null,[t(c,null,{default:a(()=>[t(k(he))]),_:1}),m(" "+g(l.viewCount),1)]),i("span",null,[t(c,null,{default:a(()=>[t(k(R))]),_:1}),m(" "+g(l.likeCount),1)]),i("span",null,[t(c,null,{default:a(()=>[t(k(ke))]),_:1}),m(" "+g(l.commentCount),1)])])])])],8,xe))),128))])),[[pe,N.value]]),b.value.length===0&&!N.value?(u(),_("div",Ne,[t(ae,{description:"暂无作品，快来发布你的摄影作品吧！"})])):w("",!0),b.value.length>0?(u(),_("div",$e,[t(oe,{"current-page":h.page,"onUpdate:currentPage":e[3]||(e[3]=l=>h.page=l),"page-size":h.size,"onUpdate:pageSize":e[4]||(e[4]=l=>h.size=l),total:h.total,onCurrentChange:q},null,8,["current-page","page-size","total"])])):w("",!0),t(H,{modelValue:S.value,"onUpdate:modelValue":e[15]||(e[15]=l=>S.value=l),title:"发布作品",width:"600px",onClose:A},{footer:a(()=>[i("span",Pe,[t(p,{onClick:e[14]||(e[14]=l=>S.value=!1)},{default:a(()=>[...e[24]||(e[24]=[m("取消",-1)])]),_:1}),t(p,{type:"primary",onClick:Z,loading:$.value},{default:a(()=>[...e[25]||(e[25]=[m(" 发布 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[t(ie,{ref_key:"publishFormRef",ref:z,model:o,rules:j,"label-width":"100px"},{default:a(()=>[t(y,{label:"作品标题",prop:"title"},{default:a(()=>[t(v,{modelValue:o.title,"onUpdate:modelValue":e[5]||(e[5]=l=>o.title=l),placeholder:"请输入作品标题"},null,8,["modelValue"])]),_:1}),t(y,{label:"作品描述",prop:"description"},{default:a(()=>[t(v,{modelValue:o.description,"onUpdate:modelValue":e[6]||(e[6]=l=>o.description=l),type:"textarea",rows:3,placeholder:"描述你的作品..."},null,8,["modelValue"])]),_:1}),t(y,{label:"作品分类",prop:"categoryId"},{default:a(()=>[t(U,{modelValue:o.categoryId,"onUpdate:modelValue":e[7]||(e[7]=l=>o.categoryId=l),placeholder:"选择分类",style:{width:"100%"}},{default:a(()=>[t(r,{label:"人像",value:1}),t(r,{label:"风景",value:2}),t(r,{label:"街拍",value:3}),t(r,{label:"纪实",value:4}),t(r,{label:"其他",value:5})]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"标签",prop:"tags"},{default:a(()=>[t(v,{modelValue:o.tags,"onUpdate:modelValue":e[8]||(e[8]=l=>o.tags=l),placeholder:"多个标签用逗号分隔"},null,8,["modelValue"])]),_:1}),t(y,{label:"拍摄器材",prop:"equipment"},{default:a(()=>[t(v,{modelValue:o.equipment,"onUpdate:modelValue":e[9]||(e[9]=l=>o.equipment=l),placeholder:"如：Canon EOS R5"},null,8,["modelValue"])]),_:1}),t(y,{label:"拍摄参数",prop:"settings"},{default:a(()=>[t(v,{modelValue:o.settings,"onUpdate:modelValue":e[10]||(e[10]=l=>o.settings=l),placeholder:"如：f/2.8, 1/200s, ISO 400"},null,8,["modelValue"])]),_:1}),t(y,{label:"拍摄地点",prop:"location"},{default:a(()=>[t(v,{modelValue:o.location,"onUpdate:modelValue":e[11]||(e[11]=l=>o.location=l),placeholder:"请输入拍摄地点"},null,8,["modelValue"])]),_:1}),t(y,{label:"拍摄时间",prop:"shootTime"},{default:a(()=>[t(se,{modelValue:o.shootTime,"onUpdate:modelValue":e[12]||(e[12]=l=>o.shootTime=l),type:"datetime",placeholder:"选择拍摄时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(y,{label:"封面图",prop:"coverImage"},{default:a(()=>[t(E,{class:"upload-cover",action:"/api/v1/file/upload/image",headers:J.value,"show-file-list":!1,"on-success":Q,"before-upload":W},{default:a(()=>[o.coverImage?(u(),_("img",{key:0,src:o.coverImage,class:"upload-preview"},null,8,De)):(u(),T(p,{key:1,type:"primary",plain:""},{default:a(()=>[...e[21]||(e[21]=[m("点击上传封面",-1)])]),_:1}))]),_:1},8,["headers"])]),_:1}),t(y,{label:"作品图片",prop:"images"},{default:a(()=>[t(E,{action:"/api/v1/file/upload/image",headers:J.value,"list-type":"picture-card","on-success":X,"on-remove":Y,"before-upload":W,"file-list":C.value},{default:a(()=>[t(c,null,{default:a(()=>[t(k(K))]),_:1})]),_:1},8,["headers","file-list"])]),_:1}),t(y,{label:"是否公开",prop:"isPublic"},{default:a(()=>[t(ne,{modelValue:o.isPublic,"onUpdate:modelValue":e[13]||(e[13]=l=>o.isPublic=l)},{default:a(()=>[t(M,{label:1},{default:a(()=>[...e[22]||(e[22]=[m("公开",-1)])]),_:1}),t(M,{label:0},{default:a(()=>[...e[23]||(e[23]=[m("私密",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(H,{modelValue:D.value,"onUpdate:modelValue":e[18]||(e[18]=l=>D.value=l),title:s.value?.title,width:"800px","destroy-on-close":""},{default:a(()=>[s.value?(u(),_("div",Be,[i("div",Fe,[s.value.images?(u(),T(ue,{key:0,height:"400px"},{default:a(()=>[(u(!0),_(B,null,F(JSON.parse(s.value.images),l=>(u(),T(re,{key:l},{default:a(()=>[t(P,{src:l,fit:"contain",style:{width:"100%",height:"100%"}},null,8,["src"])]),_:2},1024))),128))]),_:1})):(u(),T(P,{key:1,src:s.value.coverImage,fit:"contain",style:{width:"100%",height:"400px"}},null,8,["src"]))]),i("div",Oe,[i("div",Re,[i("div",Je,[t(de,{size:40,src:s.value.authorAvatar},{default:a(()=>[m(g(s.value.authorNickname?.charAt(0)),1)]),_:1},8,["src"]),i("div",null,[i("div",Le,g(s.value.authorNickname),1),i("div",We,g(s.value.createTime),1)])]),i("div",Ae,[t(p,{type:"primary",icon:k(R),onClick:e[16]||(e[16]=l=>te(s.value))},{default:a(()=>[m(g(s.value.likeCount),1)]),_:1},8,["icon"]),t(p,{type:"warning",icon:k(R),onClick:e[17]||(e[17]=l=>le(s.value))},{default:a(()=>[m(g(s.value.collectCount),1)]),_:1},8,["icon"])])]),i("div",Ee,[i("p",Me,g(s.value.description),1),i("div",He,[s.value.equipment?(u(),_("div",Ke,[e[26]||(e[26]=i("strong",null,"器材：",-1)),m(g(s.value.equipment),1)])):w("",!0),s.value.settings?(u(),_("div",je,[e[27]||(e[27]=i("strong",null,"参数：",-1)),m(g(s.value.settings),1)])):w("",!0),s.value.location?(u(),_("div",Ge,[e[28]||(e[28]=i("strong",null,"地点：",-1)),m(g(s.value.location),1)])):w("",!0),s.value.shootTime?(u(),_("div",Qe,[e[29]||(e[29]=i("strong",null,"时间：",-1)),m(g(s.value.shootTime),1)])):w("",!0)]),s.value.tags?(u(),_("div",Xe,[(u(!0),_(B,null,F(JSON.parse(s.value.tags),l=>(u(),T(ce,{key:l,size:"small",style:{"margin-right":"5px"}},{default:a(()=>[m(g(l),1)]),_:2},1024))),128))])):w("",!0)])])])):w("",!0)]),_:1},8,["modelValue","title"])])}}},lt=me(Ye,[["__scopeId","data-v-84839b1c"]]);export{lt as default};
