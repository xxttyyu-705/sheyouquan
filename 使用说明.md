# 摄友圈社区系统 - 使用说明

## 问题修复说明

### 1. 文件上传404错误修复
**问题原因**：前端调用的文件上传接口地址错误，使用了 `http://localhost:3002/file/upload/image`，但后端实际运行在 `http://localhost:8081/api/v1`。

**修复方案**：
- 后端文件上传接口路径为：`/api/v1/file/upload/image`
- 前端需要确保上传地址正确配置
- 文件上传功能已配置为公开访问，无需认证

### 2. API 403错误修复
**问题原因**：后端的 `WebSecurityConfig` 中，部分API接口没有添加到公开访问列表，导致需要认证才能访问。

**修复方案**：
- 已将以下接口添加到公开访问列表：
  - `/product/list` - 商品列表
  - `/product/detail/**` - 商品详情
  - `/exchange/list` - 兑换记录
  - `/point/balance` - 积分余额
  - `/point/history` - 积分历史
  - `/comment/list` - 评论列表
  - `/file/upload/**` - 文件上传
  - `/file/{filename:.+}` - 文件访问

### 3. 假数据初始化
**数据初始化脚本**：`database/init_data.sql`

**包含的数据**（根据 `schema_mysql5.sql` 创建）：
- **用户数据**：4个用户（1个管理员 + 3个普通用户）
- **用户标签**：3个标签（摄影大师、摄影爱好者、新手入门）
- **作品数据**：5个摄影作品（人像、风光、街拍等）
- **作品分类**：5个分类（人像摄影、风光摄影、街拍摄影等）
- **作品标签**：5个标签（夜景、人像、风景、街拍、黑白）
- **帖子数据**：5个摄影相关帖子
- **评论数据**：8条评论（包含回复）
- **课程数据**：5个摄影课程
- **课程分类**：4个分类（摄影基础、后期处理、器材使用、专题课程）
- **课程章节**：7个章节
- **商城商品**：8个商品（器材、配件、书籍、周边）
- **商城分类**：4个分类（摄影器材、配件、书籍、周边）
- **积分记录**：10条积分记录
- **兑换记录**：3条兑换记录
- **订单数据**：3个订单
- **收货地址**：3个地址
- **话题数据**：5个话题
- **系统配置**：7个配置项
- **点赞记录**：8条记录
- **收藏记录**：5条记录
- **用户课程**：3条记录
- **签到记录**：4条记录
- **通知数据**：4条通知
- **文件记录**：3条文件记录

## 快速启动指南

### 步骤1：启动后端服务
1. 确保已安装Java 8+和Maven
2. 确保MySQL数据库已启动，数据库名为 `shengyouquan`
3. 执行启动脚本：
   ```bash
   双击运行 "启动项目.bat"
   选择 [1] 启动后端服务
   ```

### 步骤2：初始化数据
1. 在启动脚本中选择 [3] 执行数据初始化
2. 输入数据库用户名和密码（默认：root/123456）
3. 等待数据初始化完成

### 步骤3：启动前端服务
1. 确保已安装Node.js
2. 在启动脚本中选择 [2] 启动前端服务
3. 或者手动执行：
   ```bash
   cd frontend
   npm install
   npm run dev
   ```

### 步骤4：访问系统
- 前端地址：`http://localhost:3002`
- 后端地址：`http://localhost:8081/api/v1`

## 功能测试

### 商城功能
1. 访问商城页面，查看商品列表
2. 搜索商品（如"相机"、"软件"）
3. 按分类筛选（摄影器材、后期软件、摄影课程、周边商品）
4. 查看商品详情
5. 兑换商品（需要先登录）

### 社区功能
1. 查看帖子列表
2. 搜索帖子
3. 查看帖子详情和评论
4. 发布新帖子（需要先登录）
5. 发表评论（需要先登录）
6. 点赞帖子

### 个人中心功能
1. 登录/注册
2. 查看和修改个人信息
3. 查看积分记录
4. 查看我的作品
5. 查看我的课程
6. 查看我的订单
7. 查看兑换记录

## 常见问题

### Q1: 数据库连接失败
**解决方案**：
1. 确保MySQL已启动
2. 检查数据库配置：`backend/src/main/resources/application.yml`
3. 确保数据库名：`shengyouquan`
4. 确保用户名密码正确

### Q2: 前端无法连接后端
**解决方案**：
1. 检查后端服务是否正常启动
2. 检查前端 `main.js` 中的 `axios.defaults.baseURL` 配置
3. 确保端口和路径正确：`http://localhost:8081/api/v1`

### Q3: 文件上传失败
**解决方案**：
1. 确保上传目录存在：`D:/uploads/shengyouquan/`
2. 检查文件上传配置：`application.yml` 中的 `file.upload.path`
3. 确保有写入权限

### Q4: 403 Forbidden错误
**解决方案**：
1. 检查 `WebSecurityConfig.java` 中的公开接口配置
2. 确保需要认证的接口已添加到请求头中
3. 检查JWT token是否正确

## API接口说明

### 公开接口（无需认证）
- `GET /api/v1/product/list` - 商品列表
- `GET /api/v1/product/detail/{id}` - 商品详情
- `GET /api/v1/post/list` - 帖子列表
- `GET /api/v1/post/detail/{id}` - 帖子详情
- `GET /api/v1/comment/list` - 评论列表
- `GET /api/v1/point/balance` - 积分余额
- `GET /api/v1/point/history` - 积分历史
- `GET /api/v1/exchange/list` - 兑换记录
- `POST /api/v1/file/upload/image` - 文件上传
- `GET /api/v1/file/{filename}` - 文件访问

### 需要认证的接口
- `POST /api/v1/post/create` - 发布帖子
- `POST /api/v1/post/like/{id}` - 点赞帖子
- `POST /api/v1/comment/create` - 发表评论
- `POST /api/v1/comment/reply` - 回复评论
- `POST /api/v1/exchange/create` - 创建兑换
- `PUT /api/v1/user/info` - 更新用户信息
- `GET /api/v1/user/info` - 获取用户信息

## 技术栈

### 后端
- Spring Boot 2.7+
- MyBatis Plus
- Spring Security + JWT
- MySQL
- Redis

### 前端
- Vue 3 + Vite
- Element Plus
- Axios
- Pinia

## 项目结构

```
摄友圈社区系统/
├── backend/                    # 后端代码
│   ├── src/main/java/         # Java源代码
│   ├── src/main/resources/    # 配置文件
│   └── pom.xml                # Maven配置
├── frontend/                   # 前端代码
│   ├── src/                   # Vue源代码
│   ├── package.json           # npm配置
│   └── vite.config.js         # Vite配置
├── database/                   # 数据库脚本
│   ├── schema.sql            # 数据库结构
│   └── init_data.sql         # 初始化数据
├── README.md                  # 项目说明
├── 使用说明.md                # 使用说明（本文件）
└── 启动项目.bat               # 启动脚本
```

## 开发建议

1. **开发环境**：建议使用VS Code或IntelliJ IDEA
2. **数据库工具**：建议使用Navicat或MySQL Workbench
3. **接口测试**：建议使用Postman或Apifox
4. **版本控制**：建议使用Git进行版本管理

## 联系方式

如有问题，请通过以下方式联系：
- 项目地址：查看README.md
- 技术支持：摄友圈开发团队

---

**祝您使用愉快！** 🎉
