# 摄友圈社区系统 - 登录注册功能修复说明

## 问题描述
用户反馈登录和注册功能无法正常使用。

## 已发现的问题

### 1. 前端API路径重复问题
**问题**: 前端`main.js`中的`baseURL`配置为`http://localhost:8082/api/v1`，但后端`application.yml`中配置了`context-path: /api/v1`，导致请求路径重复。

**修复**: 
- 修改`frontend/src/main.js`中的`baseURL`从`http://localhost:8082/api/v1`改为`http://localhost:8082`
- 这样请求会正确发送到`http://localhost:8082/api/v1/user/login`而不是`http://localhost:8082/api/v1/api/v1/user/login`

### 2. Vite代理配置端口问题
**问题**: `frontend/vite.config.js`中的代理配置指向`http://localhost:8081`，但后端实际运行在`8082`端口。

**修复**:
- 修改`frontend/vite.config.js`中的代理目标从`http://localhost:8081`改为`http://localhost:8082`

### 3. Spring Security URL匹配问题
**问题**: `WebSecurityConfig.java`中的URL路径配置不正确，公开接口的路径包含了`/api/v1`前缀，但实际请求路径是`/user/register`、`/user/login`等。

**修复**:
- 修改安全配置中的URL匹配路径，从`/api/v1/user/register`改为`/user/register`
- 从`/api/v1/user/login`改为`/user/login`
- 从`/api/v1/user/check/**`改为`/user/check/**`

### 4. 测试脚本端口配置问题
**问题**: `测试注册登录.bat`脚本中使用的是`8081`端口，但后端实际运行在`8082`端口。

**修复**:
- 修改测试脚本中的所有`8081`端口为`8082`

## 修复验证

### 后端API测试结果

#### 注册接口测试
```bash
# 请求
POST http://localhost:8082/api/v1/user/register
Content-Type: application/json
Body: {"username":"testuser3","email":"test3@example.com","password":"123456","confirmPassword":"123456"}

# 响应
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "id": 45,
    "username": "testuser3",
    "email": "test3@example.com",
    "nickname": "testuser3",
    "role": "user",
    "status": 1,
    "points": 10
  }
}
```

**结果**: ✅ 注册接口正常工作

#### 登录接口测试
```bash
# 请求
POST http://localhost:8082/api/v1/user/login
Content-Type: application/json
Body: {"username":"testuser3","password":"123456"}

# 响应
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzUxMiJ9.eyJyb2xlIjoidXNlciIsInVzZXJJZCI6NDUsInVzZXJuYW1lIjoidGVz…",
    "userInfo": {
      "id": 45,
      "username": "testuser3",
      "email": "test3@example.com",
      "nickname": "testuser3",
      "role": "user",
      "status": 1,
      "points": 10
    }
  }
}
```

**结果**: ✅ 登录接口正常工作

## 修复的文件列表

1. **frontend/src/main.js**
   - 修改`baseURL`配置，移除重复的`/api/v1`路径

2. **frontend/vite.config.js**
   - 修改代理配置端口从`8081`改为`8082`

3. **backend/src/main/java/com/shengyouquan/config/WebSecurityConfig.java**
   - 修改URL匹配路径，移除`/api/v1`前缀

4. **测试注册登录.bat**
   - 修改端口配置从`8081`改为`8082`

## 当前状态

### ✅ 已完成的修复
- [x] 修复前端API路径重复问题
- [x] 修复Vite代理配置端口问题
- [x] 修复Spring Security URL匹配问题
- [x] 修复测试脚本端口配置
- [x] 后端注册接口测试通过
- [x] 后端登录接口测试通过

### ⚠️ 前端页面访问问题
前端页面访问仍然存在问题（404错误），可能的原因：
1. Vite服务配置问题
2. 路由配置问题
3. 浏览器缓存问题

**建议**:
1. 清除浏览器缓存后重试
2. 检查Vite服务控制台是否有错误信息
3. 尝试使用无痕模式访问
4. 检查网络连接和防火墙设置

## 使用说明

### 启动服务
1. 启动后端服务：
   ```bash
   cd 摄友圈社区系统/backend
   mvn spring-boot:run
   ```

2. 启动前端服务：
   ```bash
   cd 摄友圈社区系统/frontend
   npm run dev
   ```

### 测试API
可以使用提供的测试脚本：
```bash
摄友圈社区系统/测试注册登录.bat
```

或者手动测试：
- 注册：`POST http://localhost:8082/api/v1/user/register`
- 登录：`POST http://localhost:8082/api/v1/user/login`

## 注意事项

1. 确保MySQL数据库已启动并正确配置
2. 确保Redis服务已启动（如果需要）
3. 后端服务默认端口：`8082`
4. 前端服务默认端口：`3004`
5. API文档地址：`http://localhost:8081/swagger-ui.html`

## 技术细节

### 安全配置
- JWT令牌有效期：24小时
- 密码使用BCrypt加密
- CSRF已禁用（开发环境）
- CORS已配置允许本地开发环境

### 数据库配置
- 数据库名：`shengyouquan`
- 用户名：`root`
- 密码：`123456`

## 联系方式
如有问题，请联系摄友圈开发团队。
