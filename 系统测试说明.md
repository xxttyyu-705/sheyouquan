# 摄友圈社区系统 - 测试说明

## 系统概述

摄友圈社区系统是一个基于Spring Boot + Vue.js的摄影爱好者社区平台，包含以下核心模块：

1. **统一认证与授权模块** - JWT认证、权限管理
2. **用户中心模块** - 用户注册、登录、个人信息管理
3. **全局文件服务模块** - 图片上传、下载、删除
4. **数据统计模块** - 系统概览、用户统计、收入统计
5. **内容管理模块** - 作品、课程、帖子管理
6. **作品模块** - 作品发布、浏览、点赞
7. **课程与订单模块** - 课程购买、订单管理
8. **积分与商城模块** - 积分获取、商品兑换
9. **社区互动模块** - 帖子发布、评论互动
10. **管理员后台模块** - 全面的管理功能

## 技术栈

- **后端**: Java 17 + Spring Boot 3.x + MyBatis-Plus + MySQL
- **前端**: Vue 3 + Vite + Element Plus + Axios
- **数据库**: MySQL 8.0+
- **开发工具**: Maven + Navicat + VS Code

## 数据库配置

### 1. 创建数据库

```sql
CREATE DATABASE shengyouquan CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 2. 导入表结构

执行 `database/schema.sql` 文件创建所有表结构。

### 3. 配置数据库连接

编辑 `backend/src/main/resources/application.yml`:

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/shengyouquan?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
    username: root
    password: your_password  # 修改为你的数据库密码
```

## 后端启动步骤

### 1. 编译项目

```bash
cd 摄友圈社区系统/backend
mvn clean install
```

### 2. 启动后端服务

```bash
mvn spring-boot:run
```

或者运行编译后的jar包：

```bash
java -jar target/shengyouquan-1.0.0.jar
```

后端服务默认运行在: `http://localhost:8081`

## 前端启动步骤

### 1. 安装依赖

```bash
cd 摄友圈社区系统/frontend
npm install
```

### 2. 启动开发服务器

```bash
npm run dev
```

前端服务默认运行在: `http://localhost:5173`

## API接口测试

### 1. 用户认证模块

#### 注册新用户
```bash
curl -X POST http://localhost:8081/api/user/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "123456",
    "nickname": "测试用户",
    "email": "test@example.com"
  }'
```

#### 用户登录
```bash
curl -X POST http://localhost:8081/api/user/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "123456"
  }'
```

#### 获取用户信息
```bash
curl -X GET http://localhost:8081/api/user/profile \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

### 2. 作品模块

#### 发布作品
```bash
curl -X POST http://localhost:8081/api/works \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "我的摄影作品",
    "description": "这是一张美丽的风景照",
    "images": "http://localhost:8081/api/file/2024/12/31/xxx.jpg",
    "tags": "风景,摄影"
  }'
```

#### 获取作品列表
```bash
curl -X GET "http://localhost:8081/api/works?page=1&size=10" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

### 3. 课程模块

#### 创建课程
```bash
curl -X POST http://localhost:8081/api/courses \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "摄影入门基础",
    "description": "从零开始学习摄影技巧",
    "teacherName": "张老师",
    "category": "basic",
    "difficulty": 1,
    "duration": 120,
    "price": 0,
    "isFree": 1,
    "coverImage": "http://localhost:8081/api/file/2024/12/31/xxx.jpg"
  }'
```

### 4. 商城模块

#### 创建商品
```bash
curl -X POST http://localhost:8081/api/products \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "摄影技巧手册",
    "description": "详细的摄影技巧指南",
    "points": 800,
    "stock": 100,
    "image": "http://localhost:8081/api/file/2024/12/31/xxx.jpg",
    "category": "book"
  }'
```

#### 兑换商品
```bash
curl -X POST http://localhost:8081/api/exchange \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "productId": 1,
    "quantity": 1
  }'
```

### 5. 社区模块

#### 发布帖子
```bash
curl -X POST http://localhost:8081/api/posts \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "摄影技巧讨论",
    "content": "大家觉得夜景摄影有什么技巧？",
    "tags": "夜景,技巧"
  }'
```

#### 发表评论
```bash
curl -X POST http://localhost:8081/api/comments \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "postId": 1,
    "content": "我觉得三脚架很重要"
  }'
```

### 6. 数据统计模块

#### 获取系统概览
```bash
curl -X GET http://localhost:8081/api/stats/overview \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### 获取收入统计
```bash
curl -X GET http://localhost:8081/api/stats/income \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

### 7. 文件上传模块

#### 上传图片
```bash
curl -X POST http://localhost:8081/api/file/upload/image \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -F "file=@/path/to/your/image.jpg"
```

### 8. 管理员后台模块

#### 获取管理后台概览
```bash
curl -X GET http://localhost:8081/api/admin/dashboard \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### 获取用户列表
```bash
curl -X GET "http://localhost:8081/api/admin/users?page=1&size=10" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### 审核作品
```bash
curl -X POST "http://localhost:8081/api/admin/works/1/review?status=1" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

## 前端功能测试

### 1. 用户界面测试

1. **注册页面** (`/register`)
   - 测试用户名、密码、邮箱的表单验证
   - 测试注册成功后的跳转
   - 测试重复用户名的错误提示

2. **登录页面** (`/login`)
   - 测试用户名密码登录
   - 测试登录成功后的token存储
   - 测试错误凭据的提示

3. **用户中心** (`/profile`)
   - 测试个人信息查看和修改
   - 测试积分显示
   - 测试头像上传

### 2. 内容功能测试

1. **作品页面** (`/works`)
   - 测试作品列表加载
   - 测试发布新作品（标题、描述、图片上传）
   - 测试作品详情查看
   - 测试点赞功能

2. **课程页面** (`/courses`)
   - 测试课程列表展示
   - 测试课程详情查看
   - 测试免费课程学习
   - 测试付费课程购买流程

3. **商城页面** (`/mall`)
   - 测试商品列表展示
   - 测试积分兑换商品
   - 测试积分不足提示
   - 测试兑换记录查看

4. **社区页面** (`/community`)
   - 测试帖子列表加载
   - 测试发布新帖子
   - 测试评论功能
   - 测试帖子详情查看

### 3. 管理后台测试

1. **用户管理**
   - 测试用户列表分页
   - 测试用户搜索
   - 测试启用/禁用用户
   - 测试删除用户

2. **作品管理**
   - 测试作品列表分页
   - 测试作品审核（显示/隐藏）
   - 测试删除作品

3. **课程管理**
   - 测试课程添加
   - 测试课程上架/下架
   - 测试课程删除
   - 测试封面图上传

4. **订单管理**
   - 测试订单列表查看
   - 测试订单状态筛选
   - 测试退款操作

5. **数据统计**
   - 测试概览数据展示
   - 测试统计图表显示

## 测试数据准备

### 1. 创建测试用户

```sql
-- 管理员用户
INSERT INTO user (username, password, nickname, email, points, status, role) 
VALUES ('admin', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBa40.6Q0iMlO2', '管理员', 'admin@shengyouquan.com', 9999, 1, 'admin');

-- 普通用户
INSERT INTO user (username, password, nickname, email, points, status) 
VALUES ('test', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBa40.6Q0iMlO2', '测试用户', 'test@shengyouquan.com', 1000, 1);
```

### 2. 创建测试商品

```sql
INSERT INTO product (name, description, points, stock, image, category) VALUES
('摄影技巧手册', '详细摄影技巧指南', 800, 50, 'https://example.com/book.jpg', 'book'),
('相机清洁套装', '专业相机清洁工具', 1500, 30, 'https://example.com/cleaner.jpg', 'tool'),
('摄影课程优惠券', '8折优惠券', 500, 100, 'https://example.com/coupon.jpg', 'coupon');
```

## 常见问题排查

### 1. 数据库连接失败
- 检查MySQL服务是否启动
- 检查数据库名称、用户名、密码是否正确
- 检查端口是否被占用（默认3306）

### 2. 前端无法连接后端
- 检查后端服务是否正常运行
- 检查CORS配置是否正确
- 检查前端API地址配置

### 3. 文件上传失败
- 检查uploads目录权限
- 检查磁盘空间
- 检查文件大小限制

### 4. JWT认证失败
- 检查token是否正确存储在localStorage
- 检查token是否过期
- 检查请求头是否正确设置Authorization

## 性能测试建议

1. **并发用户测试**: 使用JMeter测试100+并发用户
2. **接口响应时间**: 监控各API响应时间，应<500ms
3. **数据库性能**: 检查慢查询日志，优化索引
4. **内存使用**: 监控JVM内存使用情况

## 安全测试建议

1. **SQL注入测试**: 对所有输入参数进行SQL注入测试
2. **XSS攻击测试**: 测试跨站脚本攻击防护
3. **CSRF测试**: 测试跨站请求伪造防护
4. **权限绕过测试**: 测试未授权访问

## 部署建议

### 1. 生产环境配置
- 修改数据库连接为生产环境
- 配置HTTPS
- 设置强密码和密钥
- 配置防火墙规则

### 2. 监控配置
- 配置日志系统
- 设置异常监控
- 配置性能监控
- 设置告警机制

### 3. 备份策略
- 定期备份数据库
- 备份上传的文件
- 备份配置文件

---

**注意**: 本系统为演示版本，实际部署时请根据具体需求进行安全加固和性能优化。
